<task name="gsi_d03_E#ENS#" maxtries="&MAX_TRIES;">
  
  <command>&PRE; &EXhwrf;/exhwrf_gsi.py</command>
  <jobname>hwrf_gsi_d03_&SID;_<cyclestr>@Y@m@d@H</cyclestr>_E#ENS#</jobname>
  <account>&ACCOUNT;</account>
  <queue>&PE;</queue>
  <nodes>&GSI_D03_NODES;</nodes>
  <envar>
    <name>TOTAL_TASKS</name>
    <value>&GSI_D03_TASKS;</value>
  </envar>
  <envar>
    <name>GSI_DOMAIN</name>
    <value>d03</value>
  </envar>
  <walltime>&GSI_D03_WALLTIME;</walltime>
  <memory></memory>
  <stdout><cyclestr>&WORKhwrf;/hwrf_gsi_d03.out</cyclestr></stdout>
  <stderr><cyclestr>&WORKhwrf;/hwrf_gsi_d03.err</cyclestr></stderr>

  &ENV_VARS;
  &RESERVATION;
  &NODES_EXTRA;
  &MPI_EXTRA;

  <envar>
    <name>OMP_NUM_THREADS</name>
    <value>&GSI_D03_THREADS;</value>
  </envar>

  <dependency>
    <and>
      <metataskdep metatask="meta_relocate_gdas1_E#ENS#"/>
      <taskdep task="init_GFS_0_E#ENS#"/>
      <streq><left>&RUN_GSI;</left><right>YES</right></streq>
      <taskdep task="bufrprep_E#ENS#"/>
      <or>
        <streq><left>&CONDITIONAL_GSID03;</left><right>NO</right></streq>
        <datadep><cyclestr>&COMhwrf;/&STORMLABEL;.tdr</cyclestr></datadep>
      </or>
      <or>
        <strneq><left>&DA_ENSEMBLE;</left><right>YES</right></strneq>
        <taskdep task="ensda_output" cycle_offset="-6:00:00"/>
        <not>
          <cycleexistdep cycle_offset="-6:00:00"/>
        </not>
        <sh>grep 'RUN_ENSDA=NO' <cyclestr offset="-6:00:00">&COMhwrf;/&STORMLABEL;.run_ensda</cyclestr></sh>
      </or>
      <sh>grep 'run_gsi_d03=YES' <cyclestr>&COMhwrf;/&STORMLABEL;.gsi_status</cyclestr></sh>
    </and>
  </dependency>

</task>
